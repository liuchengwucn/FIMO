{"problem_name": "imosl_2016_algebra_p4", "informal_statement": "Denote by $\\mathbb{R}^{+}$the set of all positive real numbers. Find all functions $f: \\mathbb{R}^{+} \\rightarrow \\mathbb{R}^{+}$such that\n\n$$\nx f\\left(x^{2}\\right) f(f(y))+f(y f(x))=f(x y)\\left(f\\left(f\\left(x^{2}\\right)\\right)+f\\left(f\\left(y^{2}\\right)\\right)\\right)\n$$\n\nfor all positive real numbers $x$ and $y$.\n\nThe final answer is $f(x)=\\frac{1}{x}$ for any $x \\in \\mathbb{R}^{+}$.", "informal_proof": "Taking $x=y=1$ in (1), we get $f(1) f(f(1))+f(f(1))=2 f(1) f(f(1))$ and hence $f(1)=1$. Swapping $x$ and $y$ in (1) and comparing with (1) again, we find\n\n$$\nx f\\left(x^{2}\\right) f(f(y))+f(y f(x))=y f\\left(y^{2}\\right) f(f(x))+f(x f(y)) .\n$$\n\nTaking $y=1$ in $(2)$, we have $x f\\left(x^{2}\\right)+f(f(x))=f(f(x))+f(x)$, that is,\n\n$$\nf\\left(x^{2}\\right)=\\frac{f(x)}{x}\n$$\n\nTake $y=1$ in (1) and apply (3) to $x f\\left(x^{2}\\right)$. We get $f(x)+f(f(x))=f(x)\\left(f\\left(f\\left(x^{2}\\right)\\right)+1\\right)$, which implies\n\n$$\nf\\left(f\\left(x^{2}\\right)\\right)=\\frac{f(f(x))}{f(x)}\n$$\n\nFor any $x \\in \\mathbb{R}^{+}$, we find that\n\n$$\nf\\left(f(x)^{2}\\right) \\stackrel{(3)}{=} \\frac{f(f(x))}{f(x)} \\stackrel{(4)}{=} f\\left(f\\left(x^{2}\\right)\\right) \\stackrel{(3)}{=} f\\left(\\frac{f(x)}{x}\\right) .\n$$\n\nIt remains to show the following key step.\n\n\\begin{itemize}\n  \\item Claim. The function $f$ is injective.\n\\end{itemize}\n\nProof. Using (3) and (4), we rewrite (1) as\n\n$$\nf(x) f(f(y))+f(y f(x))=f(x y)\\left(\\frac{f(f(x))}{f(x)}+\\frac{f(f(y))}{f(y)}\\right) .\n$$\n\nTake $x=y$ in (6) and apply (3). This gives $f(x) f(f(x))+f(x f(x))=2 \\frac{f(f(x))}{x}$, which means\n\n$$\nf(x f(x))=f(f(x))\\left(\\frac{2}{x}-f(x)\\right)\n$$\n\nUsing (3), equation (2) can be rewritten as\n\n$$\nf(x) f(f(y))+f(y f(x))=f(y) f(f(x))+f(x f(y))\n$$\n\nSuppose $f(x)=f(y)$ for some $x, y \\in \\mathbb{R}^{+}$. Then (8) implies\n\n$$\nf(y f(y))=f(y f(x))=f(x f(y))=f(x f(x)) .\n$$\n\nUsing $(7)$, this gives\n\n$$\nf(f(y))\\left(\\frac{2}{y}-f(y)\\right)=f(f(x))\\left(\\frac{2}{x}-f(x)\\right) .\n$$\n\nNoting $f(x)=f(y)$, we find $x=y$. This establishes the injectivity. By the Claim and (5), we get the only possible solution $f(x)=\\frac{1}{x}$. It suffices to check that this is a solution. Indeed, the left-hand side of (1) becomes\n\n$$\nx \\cdot \\frac{1}{x^{2}} \\cdot y+\\frac{x}{y}=\\frac{y}{x}+\\frac{x}{y}\n$$\n\nwhile the right-hand side becomes\n\n$$\n\\frac{1}{x y}\\left(x^{2}+y^{2}\\right)=\\frac{x}{y}+\\frac{y}{x}\n$$\n\nThe two sides agree with each other."}